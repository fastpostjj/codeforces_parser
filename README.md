# Дипломный проект парсер задач  codeforces
На сайте codeforces есть подборка задач (https://codeforces.com/problemset/).

Телеграм-бот позволяет создать ежедневные рассылки задач по выбранной тематике, рейтингу и уровню сложности.

Бот понимает следующие команды:
-   __/start__ или __/help__ - приветсвенное сообщение и список доступных команд
-   __/subscribe__ тема <тема> рейтинг <рейтинг> уровень <уровень> - подписаться на рассылку
-   __/unsubscribe__ - отписаться
-   __/status__ - статус подписки
-   __/tags__ - выводит список тем
-   __/level__ - выводит значения уровней
-   __/rating__ - выводит значения рейтинга
-   __/sample__ - выводит шаблон для подписки

Задачи распределены по уровням сложности в зависимости от количества имеющихся решений.

    Уровень 1 Задачи, у которых число решений менее 10
    Уровень 2 Задачи, у которых число решений от 10 до 100
    Уровень 3 Задачи, у которых число решений от 100 до 500
    Уровень 4 Задачи, у которых число решений от 500 до 1 000
    Уровень 5 Задачи, у которых число решений от 1 000 до 10 000
    Уровень 6 Задачи, у которых число решений от 10 000 до 100 000
    Уровень 7 Задачи, у которых число решений больше 100 000


Для создания подписки необходимо отправить боту сообщение с номером темы, уровнем и рейтингом через пробел. Тема и уровень -  обязательные параметры, рейтинг - опциональный.

Пример команды для создания подписки:

    /subscribe тема 22 рейтинг 2200 уровень 5

Будет создана рассылка задач по теме strings Уровень 5 рейтинг 2200.

В файл update.log записываются сообщения о запуске команд или об ошибках выполнения.

В проекте реализованы следующие команды:
-   __python manage.py create_tasks__ - создание периодических задач проверки обновлений и рассылки сообщений в телеграм
-   __python manage.py check_update__ - скрипт загрузки новых задач
-   __python manage.py info__- выводит информацию о количестве задач и тегов в базе
-   __python manage.py send_messages__- рассылка сообщений по подписке
-   __python manage.py bot_run__- запуск бота
-   __python manage.py csu__ - создание пользователя с правами админа (логин - id 1, и пароль- 123abc123)

## Начало работы
Для начала работы необходимо создать пользователя командой __python manage.py csu__.

## Настройки проекта
    bot_token - токен бота
    POSTGRES_USER пользователь базы данных
    POSTGRES_PASSWORD пароль для базы данных
    POSTGRES_PORT=5432 порт базы данных
    POSTGRES_DB название базы данных (для локального запуска база должна быть создана заранее)
    POSTGRES_HOST=localhost - хост для базы данных для локального запуска
    REDIS_HOST=localhost - хост для работы редис для локального запуска
    REDIS_PORT=6379 - порт для работы редис

    POSTGRES_HOST=db - настройки для запуска из docker-контейнера
    REDIS_HOST=redis

## Для локального запуска проекта необходимо выполнить следующие команды:
-   при работе на Linux запустить сервисы postgresql и redis:

    sudo service postgresql start

    sudo service redis-server start
-   создать базу данных и записать ее название в переменную POSTGRES_DB в .env-файл
-   установить виртуальное окружение:

    python -m venv venv

    python3 -m venv venv
-   активировать виртуальное окружение:

    venv/Scripts/activate

    source venv/bin/activate
-   установить зависимости:

    python -m pip install -r requirements-win.txt

    python3 -m pip install -r requirments.txt
-   применить миграции:

    python manage.py migrate

-   загрузить данные из дампа:

    python  manage.py loaddata data.json

-   либо работать с пустой базой, тогда нужно создать пользователей:

    python  manage.py csu
-   запустить проект:

    python  manage.py runserver
-   в отдельном терминале запустить celery:

    celery -A config worker -l INFO -P eventlet
    celery -A config worker -l INFO
-   и beat:

    celery -A config beat -l INFO
- либо одной командой:

    celery -A config.celery worker --beat --loglevel=info -D
